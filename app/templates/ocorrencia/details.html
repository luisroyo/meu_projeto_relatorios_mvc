{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2><i class="bi bi-file-earmark-text-fill me-2"></i>{{ title }}</h2>
    <p class="lead">Detalhes completos da ocorrência oficial registrada.</p>

    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Resumo da Ocorrência</h5>
            <span class="badge bg-light text-primary fs-6">{{ ocorrencia.status }}</span>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>ID da Ocorrência:</strong> {{ ocorrencia.id }}</p>
                    <p><strong>Tipo:</strong> {{ ocorrencia.tipo.nome if ocorrencia.tipo else 'N/A' }}</p>
                    <p><strong>Registrada em:</strong> {{ ocorrencia.data_ocorrencia | localtime }}</p>
                    <p><strong>Registrada por:</strong> {{ ocorrencia.registrado_por.username if ocorrencia.registrado_por else 'N/A' }}</p>
                    <p><strong>Condomínio:</strong> {{ ocorrencia.condominio.nome if ocorrencia.condominio else 'N/A' }}</p>
                    <p><strong>Data do Plantão:</strong> {{ ocorrencia.data_plantao.strftime('%d/%m/%Y') if ocorrencia.data_plantao else 'N/A' }}</p>
                    <p><strong>Turno:</strong> {{ ocorrencia.turno or 'N/A' }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Endereço Específico:</strong> {{ ocorrencia.endereco_especifico or 'Não informado' }}</p>
                    <p><strong>Órgãos Acionados:</strong>
                        {% if ocorrencia.orgaos_acionados %}
                            {% for orgao in ocorrencia.orgaos_acionados %}
                                <span class="badge bg-info text-dark">{{ orgao.nome }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">Nenhum</span>
                        {% endif %}
                    </p>
                    <p><strong>Colaboradores Envolvidos:</strong>
                        {% if ocorrencia.colaboradores_envolvidos %}
                            {% for colaborador in ocorrencia.colaboradores_envolvidos %}
                                <span class="badge bg-secondary">{{ colaborador.nome_completo }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">Nenhum</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            <hr>
            <h6><strong>Relatório Final Oficial</strong></h6>
            <pre class="bg-light p-3 border rounded" style="white-space: pre-wrap; word-wrap: break-word;">{{ ocorrencia.relatorio_final }}</pre>
            {% if ocorrencia.log_bruto %}
            <hr>
            <h6><strong>Log Bruto Original</strong></h6>
            <pre class="bg-light p-3 border rounded" style="white-space: pre-wrap; word-wrap: break-word; max-height: 200px; overflow-y: auto;">{{ ocorrencia.log_bruto }}</pre>
            {% endif %}
        </div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('ocorrencia.listar_ocorrencias') }}" class="btn btn-secondary"><i class="bi bi-arrow-left me-1"></i>Voltar ao Histórico</a>
        <a href="{{ url_for('ocorrencia.editar_ocorrencia', ocorrencia_id=ocorrencia.id) }}" class="btn btn-warning ms-2"><i class="bi bi-pencil me-1"></i>Editar Ocorrência</a>
    </div>
</div>
{% endblock %}