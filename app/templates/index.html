{% extends "base.html" %}

{% block title %}Analisador de Relatórios IA{% endblock %}

{% block content %}
    <div class="container-fluid mt-lg-3">
        <div class="page-header text-center"> 
            <h1>Analisador de Relatórios com IA</h1>
            <p class="lead">Cole o relatório bruto abaixo para processamento e correção pela Inteligência Artificial.</p>
        </div>

        {% if current_user.is_authenticated %}
            <div class="row">
                {# Coluna para o card de Entrada do Relatório #}
                {# Adicionado col-12 para empilhar em telas pequenas por padrão #}
                <div class="col-12 col-md-6 mb-4">
                    <div class="card shadow-sm h-100"> 
                        <div class="card-header">
                            <h5 class="mb-0">Entrada do Relatório</h5>
                        </div>
                        <div class="card-body d-flex flex-column"> 
                            <div class="form-group mb-3 flex-grow-1"> 
                                <label for="relatorioBruto" class="form-label">Relatório Bruto:</label>
                                <textarea class="form-control" id="relatorioBruto" name="relatorioBruto" rows="15" placeholder="Cole o relatório bruto aqui..."></textarea>
                                <small id="charCount" class="form-text text-muted">Caracteres: 0 / 12000</small>
                            </div>
                            <div class="mt-auto"> 
                                <button type="button" class="btn btn-primary me-2" id="processarRelatorio">
                                    <span id="processarSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                    Processar Relatório
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="limparCampos">Limpar Tudo</button>
                            </div>
                        </div>
                    </div>
                </div>

                {# Coluna para o card de Relatório Processado #}
                {# Adicionado col-12 para empilhar em telas pequenas por padrão #}
                <div class="col-12 col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Relatório Processado</h5>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div id="statusProcessamento" class="mb-3"></div>
                            <div class="form-group mb-3 flex-grow-1">
                                <label for="resultadoProcessamento" class="form-label">Resultado:</label>
                                <textarea class="form-control" id="resultadoProcessamento" rows="15" readonly placeholder="O relatório processado aparecerá aqui..."></textarea>
                            </div>
                            <div class="mt-auto">
                                <button type="button" class="btn btn-info" id="copiarResultado" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Copiar para a área de transferência">
                                    Copiar Resultado
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="alert alert-warning text-center" role="alert">
                Por favor, <a href="{{ url_for('main.login') }}" class="alert-link">faça login</a> ou <a href="{{ url_for('main.register') }}" class="alert-link">registre-se</a> para utilizar o analisador de relatórios.
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
<script>
    // Inicializa tooltips do Bootstrap (se houver algum na página)
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock %}
