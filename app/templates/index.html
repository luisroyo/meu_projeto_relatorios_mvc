{# app/templates/index.html #}
{% extends "base.html" %}

{% block title %}Analisador de Relatórios IA{% endblock %}

{% block content %}
    <div class="container-fluid mt-lg-3">
        <div class="page-header text-center">
            <h1>Analisador de Relatórios com IA</h1>
            <p class="lead">Cole o relatório bruto abaixo para processamento e correção pela Inteligência Artificial.</p>
        </div>

        {% if current_user.is_authenticated %}
            <div class="row">
                {# Coluna de Entrada #}
                <div class="col-12 col-lg-4 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Entrada do Relatório</h5>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div class="form-group mb-3 flex-grow-1">
                                <label for="relatorioBruto" class="form-label">Relatório Bruto:</label>
                                <textarea class="form-control" id="relatorioBruto" name="relatorioBruto" rows="15" placeholder="Cole o relatório bruto aqui..."></textarea>
                                <small id="charCount" class="form-text text-muted">Caracteres: 0 / 12000</small>
                            </div>

                            <div class="form-group mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="formatarParaEmail">
                                    <label class="form-check-label" for="formatarParaEmail">
                                        Gerar também para E-mail Profissional
                                    </label>
                                </div>
                            </div>

                            <div class="mt-auto">
                                <div class="d-grid gap-2 d-sm-flex justify-content-sm-start">
                                    <button type="button" class="btn btn-primary btn-lg mb-2 mb-sm-0 me-sm-2 flex-grow-1 flex-sm-grow-0" id="processarRelatorio">
                                        <span id="processarSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                        Processar Relatório
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-lg flex-grow-1 flex-sm-grow-0" id="limparCampos">
                                        Limpar Tudo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {# Coluna Relatório Processado Padrão #}
                <div class="col-12 col-lg-4 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Relatório Processado (Padrão)</h5>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div id="statusProcessamento" class="mb-3"></div>
                            <div class="form-group mb-3 flex-grow-1">
                                <label for="resultadoProcessamento" class="form-label">Resultado Padrão:</label>
                                <textarea class="form-control" id="resultadoProcessamento" rows="15" readonly placeholder="O relatório padrão aparecerá aqui..."></textarea>
                            </div>
                            <div class="mt-auto">
                                <button type="button" class="btn btn-info btn-lg w-100" id="copiarResultado" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Copiar Relatório Padrão">
                                    Copiar Padrão
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                {# Coluna Relatório Formatado para Email (inicialmente oculta) #}
                <div class="col-12 col-lg-4 mb-4" id="colunaRelatorioEmail" style="display: none;">
                    <div class="card shadow-sm h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Relatório Formatado para E-mail</h5>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div id="statusProcessamentoEmail" class="mb-3"></div>
                            <div class="form-group mb-3 flex-grow-1">
                                <label for="resultadoEmail" class="form-label">Resultado para E-mail:</label>
                                <textarea class="form-control" id="resultadoEmail" rows="15" readonly placeholder="O relatório para e-mail aparecerá aqui..."></textarea>
                            </div>
                            <div class="mt-auto">
                                <button type="button" class="btn btn-success btn-lg w-100" id="copiarResultadoEmail" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Copiar Relatório para E-mail">
                                    Copiar E-mail
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        {% else %}
            <div class="alert alert-warning text-center" role="alert">
                Você precisa estar logado para usar esta funcionalidade. 
                <a href="{{ url_for('auth.login') }}" class="alert-link">Faça login</a> ou 
                <a href="{{ url_for('auth.register') }}" class="alert-link">crie uma conta</a>.
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
{{ super() }} {# Inclui scripts do base.html (Bootstrap e o script.js global) #}
<script src="{{ url_for('static', filename='js/index_page.js') }}"></script> {# Especificamente para a lógica desta página #}
<script>
    // Inicializa tooltips do Bootstrap nesta página, se houver algum novo
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock %}