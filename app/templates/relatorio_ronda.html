{% extends "base.html" %}
{% block title %}{{ title }} - Assistente de Relatórios IA{% endblock %}

{% block content %}
<div class="container-fluid mt-lg-3">
    <div class="page-header text-center">
        <h1>{{ title }}</h1>
        <p class="lead">Insira os dados do plantão e o log bruto das rondas para gerar o relatório formatado.</p>
    </div>

    <div class="row">
        <div class="col-12 col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <h5 class="mb-0">Dados do Plantão e Log de Rondas</h5>
                </div>
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('ronda.registrar_ronda') }}" novalidate>
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3"> {# Adicionado mb-3 para espaçamento #}
                            {{ form.nome_condominio.label(class="form-label") }}
                            {{ form.nome_condominio(class="form-select", id="nome_condominio_select") }}
                        </div>

                        <div id="outro_condominio_div" class="mb-3" {% if form.nome_condominio.data != 'Outro' %}style="display: none;"{% endif %}>
                            {{ form.nome_condominio_outro.label(class="form-label") }}
                            {{ form.nome_condominio_outro(class="form-control") }}
                        </div>

                        <div class="mb-3"> {# Adicionado mb-3 para espaçamento #}
                            {{ form.data_plantao.label(class="form-label") }}
                            {{ form.data_plantao(class="form-control") }}
                        </div>

                        <div class="mb-3"> {# Adicionado mb-3 para espaçamento #}
                            {{ form.escala_plantao.label(class="form-label") }}
                            {{ form.escala_plantao(class="form-select") }}
                        </div>

                        <div class="mb-3"> {# Adicionado mb-3 para espaçamento #}
                            {{ form.log_bruto_rondas.label(class="form-label") }}
                            {{ form.log_bruto_rondas(class="form-control", rows="10") }}
                        </div>

                        <div class="mt-3">
                            {{ form.submit(class="btn btn-primary") }}
                            {# Se você tiver um botão de limpar específico para este formulário, adicione-o aqui #}
                            {# Exemplo: <button type="button" class="btn btn-outline-secondary ms-2" id="limparFormRonda">Limpar Log</button> #}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <h5 class="mb-0">Relatório Gerado</h5>
                </div>
                <div class="card-body p-4">
                    <div class="report-output-container">
                        {% if relatorio_processado %}
                            {% if relatorio_processado is string and relatorio_processado.startswith("Erro:") %}
                                <div id="rondaResultadoTexto" class="alert alert-danger">{{ relatorio_processado }}</div>
                            {% elif "Nenhum evento de ronda válido" in relatorio_processado or "Nenhum log de ronda fornecido" in relatorio_processado %}
                                <div id="rondaResultadoTexto" class="alert alert-warning">{{ relatorio_processado }}</div>
                            {% elif relatorio_processado is string %}
                                <pre id="rondaResultadoTexto">{{ relatorio_processado }}</pre>
                            {% else %}
                                <div id="rondaResultadoTexto" class="alert alert-info">Formato não reconhecido ou relatório vazio.</div>
                            {% endif %}
                        {% else %}
                            <div id="rondaResultadoTexto" class="alert alert-secondary">O relatório processado aparecerá aqui.</div>
                        {% endif %}
                    </div>

                    <button type="button" class="btn btn-info mt-3" id="copiarRelatorioRonda" style="display: none;">
                        <i class="bi bi-clipboard-check me-1"></i>Copiar Relatório
                    </button>
                    <button type="button" class="btn btn-success mt-3 ms-2" id="enviarWhatsAppRonda" style="display: none;">
                        <i class="bi bi-whatsapp me-1"></i>Enviar via WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {# Garanta que o script específico da página seja carregado #}
    <script src="{{ url_for('static', filename='js/relatorio_ronda_page.js') }}"></script>
{% endblock %}